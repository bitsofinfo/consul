---
layout: docs
page_title: Connect - Terminating Gateways
sidebar_title: Terminating Gateways
description: >-
  A terminating gateway enables traffic from services in the Consul
  service mesh to services outside the mesh. This section details
  how to configure and run a terminating gateway.
---

# Terminating Gateways

-> **1.8.0+:**  This feature is available in Consul versions 1.8.0 and newer.

Terminating gateways enable connections from services in the Consul service mesh to
services outside the mesh. These gateways effectively act as Connect proxies that can
represent more than one service. They terminate Connect mTLS connections, enforce intentions,
and forward requests to the appropriate destination.

For data that must be encrypted in transit to the final destination, terminating gateways
support TLS origination. By specifying a [CA file](/docs/agent/config-entries/terminating-gateway#cafile),
[client certificate](/docs/agent/config-entries/terminating-gateway#certfile), and
[private key](/docs/agent/config-entries/terminating-gateway#keyfile),
connections from the gateway to a linked service can be encrypted using one-way or mutual TLS.
If none of these are provided, Consul will only encrypt connections to the gateway and not
from the gateway to the destination service. 

-> **Note:** If certificates and keys are configured the gateway will upgrade HTTP connections to TLS. 
Client applications can issue plain HTTP requests even when connecting to servers that require HTTPS.

## Prerequisites

Each terminating gateway needs:

1. A local Consul agent to manage its configuration.
2. General network connectivity to services within its local Consul datacenter.

Terminating gateways also require that your Consul datacenters are configured correctly:

- You'll need to use Consul version 1.8.0.
- Consul [Connect](/docs/agent/options#connect) must be enabled on the datacenter's Consul servers.
- [gRPC](/docs/agent/options#grpc_port) must be enabled on all client agents.
- [Centralized configuration](/docs/agent/options#enable_central_service_config) must be enabled.

Currently, [Envoy](https://www.envoyproxy.io/) is the only proxy with terminating gateway capabilities in Consul.

- Terminating gateway proxies receive their configuration through Consul, which
  automatically generates it based on the gateway's registration. Currently Consul
  can only translate terminating gateway registration information into Envoy
  configuration, therefore the proxies acting as terminating gateways must be Envoy.

Connect proxies that send upstream traffic through a gateway aren't
affected when you deploy terminating gateways. If you are using non-Envoy proxies as
Connect proxies they will continue to work for traffic directed at services linked to
a terminating gateway as long as they discover upstreams with the
[/health/connect](/api/health#list-nodes-for-connect-capable-service) endpoint.

## Running and Using a Terminating Gateway

You must complete the following steps to configure a terminating gateway to proxy traffic from services in the Consul service mesh:

1. On a dedicated host for the gateway start an Envoy proxy using the [envoy subcommand](/docs/commands/connect/envoy#terminating-gateways) and
specifying the `terminating` gateway type:
    ```shell
    $ consul connect envoy -gateway=terminating -register --service us-west-gateway \
      -address '{{ GetInterfaceIP "eth0" }}:8443'
    ```

2. Create and apply a `terminating-gateway` [configuration entry](/docs/agent/config-entries/terminating-gateway) that defines 
a set of services that the gateway will proxy traffic to. The config entry can be applied via the 
[CLI](/docs/commands/config/write) or [API](/api/config#apply-configuration).

3. Ensure that [Consul intentions](/docs/commands/intention) are set up between the source services in the mesh 
and the gateway's linked services. The intentions must reference the destination service's name and not the gateway itself.

4. Ensure necessary [upstreams](/docs/connect/registration/service-registration#upstream-configuration-reference)
have been added to service definitions of the source services in the Consul service mesh. Each source service that needs
to connect to a service proxied by a terminating gateway will need to add the external service as an upstream destination.

## Terminating Gateway Configuration

Terminating gateways are defined similarly to other services registered with Consul, with two exceptions.
The first is that the [kind](/api/agent/service#kind) must be "terminating-gateway". Second,
the terminating gateway service definition may contain a `Proxy.Config` entry just like a
Connect proxy service, to define opaque configuration parameters useful for the actual proxy software.
For Envoy there are some supported [gateway options](/docs/connect/proxies/envoy#gateway-options) as well as
[escape-hatch overrides](/docs/connect/proxies/envoy#escape-hatch-overrides).

-> **Note:** If ACLs are enabled, the terminating gateways must be registered with a token granting `service:write`
for the gateway's service name **and** all linked services. These permissions will authorize the gateway
to terminate mTLS connections on behalf of the linked services.

Linking services to a terminating gateway is done with a `terminating-gateway`
[configuration entry](/docs/agent/config-entries/terminating-gateway). This config entry can be applied via the 
[CLI](/docs/commands/config/write) or [API](/api/config#apply-configuration).

Gateways with the same name in Consul's service catalog are configured with a single configuration entry.
This means that additional gateway instances registered with the same name will determine their routing based on the existing configuration entry.
Adding replicas of a gateway that routes to a particular set of services requires running the
[envoy subcommand](/docs/commands/connect/envoy#terminating-gateways) on additional hosts and specifying
the same gateway name with the `service` flag.

The services that the terminating gateway will proxy for must be registered with Consul. They must also be registered
in the same Consul datacenter as the terminating gateway. Otherwise the terminating gateway will not be able to
discover the services' addresses. These services can be registered with a local Consul agent.
If there is no agent present, the services can be registered [directly in the catalog](/api/catalog#register-entity)
by sending the registration request to a client or server agent on a different host.

Since Consul's services must be associated with a node, direct registrations to the catalog must define a node as well.
This node's [name](/api/catalog.html#node) **must not** overlap with a node managed by a Consul agent.
Otherwise the service registration will be deleted by that agent during the periodic
[anti-entropy sync](/docs/internals/anti-entropy). Lastly, all agent-less services with the same address can
be registered under the same node name and address. For a complete example of how to register external services
review the [external services guide](https://learn.hashicorp.com/consul/developer-discovery/external).
